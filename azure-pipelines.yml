# We use Azure Pipelines to continuously test code.
# Azure is preferred because they have unlimited minutes for projects.
# Thus, we can use Azure for continuous integration testing of the content.
# For deploy, we will use GitHub actions, which runs only on push to master.

trigger:
- pr

pool:
  vmImage: 'ubuntu-latest'

steps:
- bash: echo "##vso[task.prependpath]$CONDA/bin"
  displayName: Add conda to PATH

- script: |
    conda install -c conda-forge mamba
    conda env create -f environment.yml
    source activate nams
    python -m ipykernel install --user --name nams
    pip install .
  displayName: Build conda environment

- script: |
    source activate nams
    jupyter nbconvert --to python scripts/bookbuilder/markua.ipynb
    python scripts/bookbuilder/markua.py
  displayName: Build LeanPub book contents

- script: |
    source activate nams
    mkdocs build
  displayName: Build website
